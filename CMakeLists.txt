set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

cmake_minimum_required(VERSION 3.10)
project(financeARLM)

# Require C++17
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

#If using conda/mamba
add_compile_options(-fmax-errors=2)

include_directories(${PROJECT_SOURCE_DIR}/include)
include_directories(${PROJECT_SOURCE_DIR}/nnets)
include_directories(${PROJECT_SOURCE_DIR}/nnets/networks)
include_directories(${PROJECT_SOURCE_DIR}/nnets/optimizers)
include_directories(${PROJECT_SOURCE_DIR}/nnets/LRSchedulers)

find_package(OpenMP REQUIRED)
find_package(BLAS REQUIRED)
find_package(LAPACK REQUIRED)

# Include Eigen (adjust this path to where you put Eigen in WSL)
# include_directories("~/eigen/eigen-5.0.0")

# Add executable
add_executable(financeARLM 
    src/main.cpp
    src/autograd.cpp
    src/tensor.cpp
    src/MatrixMultiply.cpp
    src/nditerator.cpp
)

target_link_libraries(financeARLM 
    PRIVATE 
    OpenMP::OpenMP_CXX 
    ${BLAS_LIBRARIES} 
    ${LAPACK_LIBRARIES}
)


option(BUILD_TESTS "Test Builds" OFF)

if(BUILD_TESTS)
    enable_testing()

    add_executable(test_files
        test_files/autograd_test.cpp
        
        src/autograd.cpp
        src/tensor.cpp
        src/MatrixMultiply.cpp
        src/nditerator.cpp
    )

    target_link_libraries(test_files
        PRIVATE
        OpenMP::OpenMP_CXX
        ${BLAS_LIBRARIES}
        ${LAPACK_LIBRARIES}
    )

    add_test(NAME test_files COMMAND test_files)
endif()
